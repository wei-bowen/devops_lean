## zabbix安装部署

### MySQL数据库安装

- **1、安装Zabbix软件仓库源**

`rpm -ivh http://repo.zabbix.com/zabbix/4.0/rhel/7/x86_64/zabbix-release-4.0-1.el7.noarch.rpm`

- **2、获取zabbix-server-mysql**

主要时为了获取数据库的建表语句
`yum install zabbix-server-mysql`
上面这个会失败，zabbix-server-mysql-4.0.25-1.el7.x86_64.rpm下不下来。
只能
```shell
yum deplist zabbix-server-mysql | grep provider: | awk '{print "yum install -y "$2}' | bash         ##把相关依赖先装了
wget http://repo.zabbix.com/zabbix/4.0/rhel/7/x86_64/zabbix-server-mysql-4.0.25-1.el7.x86_64.rpm    ##手动下包
rpm -ivh zabbix-server-mysql-4.0.25-1.el7.x86_64.rpm
ll /usr/share/doc/zabbix-server-mysql-4.0.25/create.sql.gz                                          ##成功获取建表包
```
- **3、下载MySQL安装包**

```shell
mkdir /app && cd /app
wget https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.27-el7-x86_64.tar
tar -xvf mysql-5.7.27-el7-x86_64.tar
tar -zxvf mysql-5.7.27-el7-x86_64.tar.gz
mv /app/mysql-5.7.27-el7-x86_64 /usr/local/mysql-5.7.27-el7-x86_64
ln -s /usr/local/mysql-5.7.27-el7-x86_64/ /usr/local/mysql
```
- **4、安装依赖库**

`yum install libaio gcc gcc-c++ pcre pcre-devel openssl openssl-devel zlib zlib-devel cmake ncurses ncurses-devel bison bison-devel -y`
- **5、添加mysql用户**

```shell
groupadd mysql
useradd -s /sbin/nologin -g mysql -M mysql
```
- **6、创建数据目录**

```shell
mkdir /opt/mysql 
chown -R mysql:mysql /opt/mysql
```
- **7、初始化配置文件**

`vim /etc/my.cnf`
```
[client]
port = 3306
socket = /tmp/mysql.sock

[mysqld]
init-connect='SET NAMES utf8'
basedir=/usr/local/mysql                      		#根据自己的安装目录填写 
datadir=/opt/mysql/data                               #根据自己的mysql数据目录填写
socket=/tmp/mysql.sock
max_connections=200                             	# 允许最大连接数
character-set-server=utf8                   		# 服务端使用的字符集默认为8比特编码的latin1字符集
default-storage-engine=INNODB             		# 创建新表时将使用的默认存储引擎
explicit_defaults_for_timestamp=true
#
# include all files from the config directory
#
!includedir /etc/my.cnf.d
```
- **8、初始化mysql**

`/usr/local/mysql/bin/mysqld --initialize-insecure --user=mysql  --basedir=/usr/local/mysql --datadir=/opt/mysql/data`
- **9、启动mysql**

`/usr/local/mysql/bin/mysqld_safe --user=mysql &`
- **10、登陆并设置root密码**

```shell
/usr/local/mysql/bin/mysql -uroot -p
use mysql;
update user set authentication_string=password('qw1203') where user='root';
flush privileges;
```
- **11、设置开机启动**

```shell
cp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysql
vim  /etc/init.d/mysql
basedir=/usr/local/mysql
datadir=/opt/mysql/date
chkconfig --add mysql
echo 'PATH=\$PATH:/usr/local/mysql/bin' >>/etc/profile
source /etc/profile
```
